<!--edit.wxml-->

<view class="container">
  <view class="page-body">
    <canvas canvas-id="shareBox" style="width:300px;height:0px;"></canvas>
    <van-notify id="van-notify" />
    <van-dialog id="van-dialog" />

    <wxs src="calDate.wxs" module="CalDate"/>
    <van-popup show="{{showTimePickerFlag}}" position="bottom" custom-style="height:45%">
      <van-datetime-picker id="datetime" type="datetime" value="{{CalDate.displayDate(matchInfo.time)}}" min-date="{{CalDate.minDate()}}" formatter="{{formatter}}" filter="{{filter}}" bind:cancel="onTimePickerCancel" bind:confirm="onTimePickerConfirm" />
    </van-popup>

    <view hidden="{{expired || hideAuthMsgBtnFlag}}">
      <van-button type="primary" size="large" bind:click="onUserAuthMsg">订阅一次「报名进展通知」消息</van-button>
    </view>

    <van-field clickable="{{!subjectDisabled}}" readonly="{{subjectDisabled}}" value="{{matchInfo.subject}}" label="比赛主题" type="textarea" placeholder="输入比赛主题" autosize clearable="{{true}}" required="{{!expired && publisher}}" bind:input='setSubjectInput'>
    <view hidden="{{subjectDisabled}}" slot="right-icon">
        <image class="" src="../../images/input.png" />
      </view>
    </van-field>

    <van-field is-link="{{!timeDisabled}}" readonly label="比赛时间" value="{{matchInfo.showTime}}" required="{{!expired && publisher}}" placeholder="选取比赛时间" bindtap="showTimePicker">
    </van-field>

    <van-field id="signUp" clickable="{{!expired}}" label="报名列表" required="{{!expired && !publisher}}" disabled="{{expired}}" value="{{fieldSUValue}}" placeholder="报名" type="text" confirm-type="报名" bind:input='setSUInput' bind:blur="updateMatchInfo" bind:click-icon="inputNameNote">
      <view hidden="{{expired}}" slot="right-icon">
        <image class="" src="../../images/add.png" />
      </view>
    </van-field>
    <text class="tag-total" hidden="{{!(matchInfo.signUpList.length)}}">已有{{matchInfo.signUpList.length}}人报名</text>
    <view class="tag-list" hidden="{{!(matchInfo.signUpList.length)}}">
      <view class="tag-item" wx:for="{{matchInfo.signUpList}}" wx:key="key" wx:for-item="item">
        <van-tag id="signUp-tag" closeable="{{item.close && !expired}}" size="large" bind:close="onTagClose" type="success" data-index="{{index}}">
          {{item.content}}
        </van-tag>
      </view>
    </view>

    <van-field id="askForLeave" clickable="{{!expired}}" label="请假列表" required="{{!expired && !publisher}}" disabled="{{expired}}" value="{{fieldAFLValue}}" placeholder="请假" type="text" confirm-type="请假" bind:input='setAFLInput' bind:blur="updateMatchInfo" bind:click-icon="inputNameNote">
      <view hidden="{{expired}}" slot="right-icon">
        <image class="" src="../../images/add.png" />
      </view>
    </van-field>
    <text class="tag-total" hidden="{{!(matchInfo.askForLeaveList.length)}}">已有{{matchInfo.askForLeaveList.length}}人请假</text>
    <view class="tag-list" hidden="{{!(matchInfo.askForLeaveList.length)}}">
      <view class="tag-item" wx:for="{{matchInfo.askForLeaveList}}" wx:key="key" wx:for-item="item">
        <van-tag id="askForLeave-tag" closeable="{{item.close && !expired}}" size="large" bind:close="onTagClose" type="success" data-index="{{index}}">
          {{item.content}}
        </van-tag>
      </view>
    </view>

    <van-field readonly required="{{!expired && publisher}}" label="场地名称" placeholder="选取比赛位置" value="{{matchInfo.location.name}}" type="textarea" autosize bind:click-icon="toLocationPage">
      <view hidden="{{locationDisabled}}" slot="right-icon">
        <image class="" src="../../images/add.png" />
      </view>
    </van-field>
    <van-field readonly required="{{!expired && publisher}}" label="场地地址" placeholder="查看比赛位置" value="{{matchInfo.location.address}}" type="textarea" autosize bind:click-icon="openLocation">
      <view hidden="{{!matchInfo.location.address.length}}" slot="right-icon">
        <image src="../../images/info.png" />
      </view>
    </van-field>
    <map id="map" longitude="{{matchInfo.location.longitude}}" latitude="{{matchInfo.location.latitude}}" scale="14" markers="{{markers}}" show-compass="true" enable-zoom="false" enable-scroll='{{false}}'></map>

    <view hidden="{{expired}}" class="btns">
      <van-button wx:if="{{publisher}}" type="primary" size="large" bind:click="submitMatchInfo">发布比赛</van-button>
      <van-button wx:if="{{publisher}}" disabled="{{publishNewMatch}}" type="default" size="large" open-type="share">转发比赛</van-button>
      <van-button wx:else disabled="{{publishNewMatch}}" type="primary" size="large" open-type="share">转发比赛</van-button>
    </view>

    <van-divider contentPosition="center">相约同城，球场竞技</van-divider>
  </view>
</view>